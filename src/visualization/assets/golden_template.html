{% extends base %}
{% block contents %}
{% if context == 'notebook' %}
  {% set layout_id = get_id() %}
  <div id='{{layout_id}}'></div>
{% endif %}

<style>
:host { width: 100%; height: 100%; }
.scrollable { overflow-y: auto; }
</style>

<script>
var config = {
    settings: {
        hasHeaders: true,
        constrainDragToContainer: true,
        reorderEnabled: true,
        selectionEnabled: false,
        popoutWholeStack: false,
        blockedPopoutsThrowError: true,
        closePopoutsOnUnload: true,
        showPopoutIcon: false,
        showMaximiseIcon: true,
        showCloseIcon: false
    },
    content: [{
        type: 'row',
        content: [
            {
                type: 'component',
                componentName: 'view',
                componentState: {
                model: '{{ embed(roots.controls) }}',
                title: 'Controls',
                width: 300,
                css_classes: ['scrollable']
                },
                isClosable: false
            },
            {
                type: 'column',
                content: [
                    {
                        type: 'row',
                        content:[
                            {
                                type: 'component',
                            componentName: 'view',
                            componentState: { model: '{{ embed(roots.plotly_view) }}', title: '2D Simulation View'},
                            },
                            {
                                type: 'stack',
                                content: [
                                    {
                                        type: 'component',
                                        componentName: 'view',
                                        componentState: { model: '{{ embed(roots.nees_view) }}', title: 'NEES Consistency' },
                                        title: 'NEES Consistency'
                                    },
                                    {
                                        type: 'component',
                                        componentName: 'view',
                                        componentState: { model: '{{ embed(roots.error_view) }}', title: 'State Errors' },
                                        title: 'State Errors'
                                    },
                                    {
                                        type: 'component',
                                        componentName: 'view',
                                        componentState: { model: '{{ embed(roots.data_browser_view) }}', title: 'Data Browser', css_classes: ['scrollable'] },
                                        title: 'Data Browser'
                                    },
                                    {
                                        type: 'component',
                                        componentName: 'view',
                                        componentState: { model: '{{ embed(roots.cost_landscape) }}', title: 'Cost Landscape', css_classes: ['scrollable'] },
                                        title: 'Cost Landscape'
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        type: 'row',
                        content:[
                            {
                                type: 'component',
                                componentName: 'view',
                                componentState: { model: '{{ embed(roots.covariance_view) }}', title: 'Covariance Matrix'},
                            },
                            {
                                type: 'component',
                                componentName: 'view',
                                componentState: { model: '{{ embed(roots.nis_view) }}', title: 'NIS Consistency'},
                                    }
                        ]
                    }
                ]
            }
        ]
    }]
};

{% if context == 'notebook' %}
  var layout = new GoldenLayout(config, '#' + '{{layout_id}}');
  $('#' + '{{layout_id}}').css({width: '100%', height: '800px', margin: '0px'});
{% else %}
  var layout = new GoldenLayout(config);
{% endif %}

layout.registerComponent('view', function(container, componentState) {
  const width = componentState.width;
  const css_classes = componentState.css_classes;
  if (width) {
    container.on('open', () => container.setSize(width, container.height));
  }
  if (css_classes) {
    css_classes.forEach((cls) => container.getElement().addClass(cls));
  }
  container.setTitle(componentState.title);
  container.getElement().html(componentState.model);
  container.on('resize', () => window.dispatchEvent(new Event('resize')));
});

layout.init();
</script>
{% endblock %}